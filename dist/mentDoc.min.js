/*! mentDoc.js 15-05-2013 */
var mentDoc=function(){function t(t,n){this.el=t,this.parent=n||null,this.attrs={},this.children=[],this.data=n?o(n.data):{},this.el.style.textDecoration="none",this.refreshAttrs(),this.updateChildren()}function n(t,i,o){var a;if(t&&i)if(o=o||t,r(t))for(a in t)"prototype"!=a&&"length"!=a&&"name"!=a&&t.hasOwnProperty(a)&&i.call(o,t[a],a);else if(t.forEach&&t.forEach!==n)t.forEach(i,o);else if(e(t)||t.hasOwnProperty("length"))for(a=0;t.length>a;a++)i.call(o,t[a],a);else for(a in t)t.hasOwnProperty(a)&&i.call(o,t[a],a);return t}function e(t){return"[object Array]"===Object.prototype.toString.call(t)}function i(t){return"object"==typeof t&&null!==t}function r(t){return"function"==typeof t}function o(t){if(Object.create)return Object.create(t);var n=function(){};return n.prototype=t,new n}var a,s={},c=1;return t.isCommandsEl=function(t){return t.nodeType===c&&"U"===t.nodeName},t.prototype={constructor:t,isRoot:!1,refreshAttrs:function(){return this.attrs={},n(this.el.attributes,function(t){if(t.specified){var n=t.name,e=this.el.getAttribute(n,3);this.attrs[a.normalizeAttr(n)]=e}},this),this},updateChildren:function(){return this.children=[],this._loopThroughEl(this.el.childNodes),this},_loopThroughEl:function(e){return n(e,function(n){if(t.isCommandsEl(n)){var e=new t(n,this);this.children.push(e),e.updateChildren()}else n.nodeType===c&&this._loopThroughEl(n.childNodes)},this),this},execute:function(){return n(this._sortedCommands(),function(t){s[t].execute(this.el,this.attrs[t],this)},this),this.executeChildren(),this},executeChildren:function(){return n(this.children,function(t){t.execute()}),this},_sortedCommands:function(){var t=[];return n(this.attrs,function(n,e){s[e]&&t.push(e)},this),t.sort(function(t,n){return s[t].priority-s[n].priority})},getElContent:function(){return this.el.innerHTML}},a={Commands:t,compile:function(n){var e;e=document.createElement("u"),e.innerHTML=n;var i=new t(e);return i.isRoot=!0,i},priority:{high:10,medium:20,low:30,"default":30},registeredCommands:s,addCommand:function(t,n){if("function"==typeof n&&(n={execute:n}),n.priority){if("string"==typeof n.priority)n.priority=this.priority[n.priority];else if(isNaN(n.priority))throw"Unknown priority given : "+n.priority}else n.priority=this.priority["default"];s[t]=n},normalizeAttr:function(){function t(t){return t.replace(e,function(t,n,e,i){return i?e.toUpperCase():e}).replace(i,"Moz$1")}var n=/^(x[\:\-_]|data[\:\-_])/i,e=/([\:\-\_]+(.))/g,i=/^moz([A-Z])/;return function(e){return t(e.replace(n,""))}}(),forEach:n,isArray:e,isObject:i,isFn:r,makeInherit:o}}();mentDoc.addCommand("inEl",function(t,n,e){e.data.inEl=n}),mentDoc.addCommand("appendTo",function(t,n,e){$(n,e.data.inEl).append(e.getElContent())}),mentDoc.addCommand("empty",function(t,n,e){$(n,e.data.inEl).empty()}),mentDoc.addCommand("remove",function(t,n,e){$(n,e.data.inEl).remove()}),mentDoc.markdown={convertHtml:function(t){var n=Markdown.getSanitizingConverter();Markdown.Extra.init(n,{extensions:"all",highlighter:"prettify"});var e=t.match(/(\t| )+\^\^\^/g);if(e){var i=e[0].length-3;lines=t.split(/\n/g);for(var r=0;lines.length>r;r++)lines[r]=lines[r].substring(i),"^^^"===lines[r]&&(lines[r]="");t=lines.join("\n")}return n.makeHtml(t)}},mentDoc.addCommand("markdown",{priority:"high",execute:function(t,n,e){e.data.compiledMarkdown=mentDoc.markdown.convertHtml(e.getElContent()),e.getElContent=function(){return e.data.compiledMarkdown}}}),"undefined"!=typeof module&&module.exports&&(module.exports.mentDoc=mentDoc);