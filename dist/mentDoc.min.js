/*! mentDoc.js 15-05-2013 */
var mentDoc=function(){function t(t,e){this.el=t,this.parent=e||null,this.attrs={},this.children=[],this.data=e?o(e.data):{},this.el.style.textDecoration="none",this.refreshAttrs(),this.updateChildren()}function e(t,i,o){var a;if(t&&i)if(o=o||t,r(t))for(a in t)"prototype"!=a&&"length"!=a&&"name"!=a&&t.hasOwnProperty(a)&&i.call(o,t[a],a);else if(t.forEach&&t.forEach!==e)t.forEach(i,o);else if(n(t)||t.hasOwnProperty("length"))for(a=0;t.length>a;a++)i.call(o,t[a],a);else for(a in t)t.hasOwnProperty(a)&&i.call(o,t[a],a);return t}function n(t){return"[object Array]"===Object.prototype.toString.call(t)}function i(t){return"object"==typeof t&&null!==t}function r(t){return"function"==typeof t}function o(t){if(Object.create)return Object.create(t);var e=function(){};return e.prototype=t,new e}var a,s={},u=1;return t.isCommandsEl=function(t){return t.nodeType===u&&"U"===t.nodeName},t.prototype={constructor:t,isRoot:!1,refreshAttrs:function(){return this.attrs={},e(this.el.attributes,function(t){if(t.specified){var e=t.name,n=this.el.getAttribute(e,3);this.attrs[a.normalizeAttr(e)]=n}},this),this},updateChildren:function(){return this.children=[],this._loopThroughEl(this.el.childNodes),this},_loopThroughEl:function(n){return e(n,function(e){if(t.isCommandsEl(e)){var n=new t(e,this);this.children.push(n),n.updateChildren()}else e.nodeType===u&&this._loopThroughEl(e.childNodes)},this),this},execute:function(){return e(this._sortedCommands(),function(t){s[t].execute(this.el,this.attrs[t],this)},this),this.executeChildren(),this},executeChildren:function(){return e(this.children,function(t){t.execute()}),this},_sortedCommands:function(){var t=[];return e(this.attrs,function(e,n){s[n]&&t.push(n)},this),t.sort(function(t,e){return s[t].priority-s[e].priority})},getElContent:function(){return this.el.innerHTML}},a={Commands:t,compile:function(e){var n;n=document.createElement("u"),n.innerHTML=e;var i=new t(n);return i.isRoot=!0,i},priority:{high:10,medium:20,low:30,"default":30},registeredCommands:s,addCommand:function(t,e){if("function"==typeof e&&(e={execute:e}),e.priority){if("string"==typeof e.priority)e.priority=this.priority[e.priority];else if(isNaN(e.priority))throw"Unknown priority given : "+e.priority}else e.priority=this.priority["default"];s[t]=e},normalizeAttr:function(){function t(t){return t.replace(n,function(t,e,n,i){return i?n.toUpperCase():n}).replace(i,"Moz$1")}var e=/^(x[\:\-_]|data[\:\-_])/i,n=/([\:\-\_]+(.))/g,i=/^moz([A-Z])/;return function(n){return t(n.replace(e,""))}}(),forEach:e,isArray:n,isObject:i,isFn:r,makeInherit:o}}();mentDoc.addCommand("inEl",function(t,e,n){n.data.inEl=e}),mentDoc.addCommand("appendTo",function(t,e,n){$(e,n.data.inEl).append(n.getElContent())}),mentDoc.addCommand("empty",function(t,e,n){$(e,n.data.inEl).empty()}),mentDoc.addCommand("remove",function(t,e,n){$(e,n.data.inEl).remove()}),mentDoc.addCommand("markdown",{priority:"high",execute:function(t,e,n){var i=Markdown.getSanitizingConverter();Markdown.Extra.init(i,{extensions:"all",highlighter:"prettify"});var r=n.getElContent(),o=r.match(/(\t| )+\^\^\^/g);if(o){var a=o[0].length-3;lines=r.split(/\n/g);for(var s=0;lines.length>s;s++)lines[s]=lines[s].substring(a),"^^^"===lines[s]&&(lines[s]="");r=lines.join("\n")}n.data.compiledMarkdown=i.makeHtml(r),n.getElContent=function(){return n.data.compiledMarkdown}}}),"undefined"!=typeof module&&module.exports&&(module.exports.mentDoc=mentDoc);