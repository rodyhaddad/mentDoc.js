/*! mentDoc.js 16-05-2013 */
var mentDoc=function(){function t(t,e){this.el=t,this.parent=e||null,this.attrs={},this.children=[],this.data=e?o(e.data):{},this.el.style.textDecoration="none",this.refreshAttrs(),this.updateChildren()}function e(t,n,o){var c;if(t&&n)if(o=o||t,r(t))for(c in t)"prototype"!=c&&"length"!=c&&"name"!=c&&t.hasOwnProperty(c)&&n.call(o,t[c],c);else if(t.forEach&&t.forEach!==e)t.forEach(n,o);else if(i(t)||t.hasOwnProperty("length"))for(c=0;t.length>c;c++)n.call(o,t[c],c);else for(c in t)t.hasOwnProperty(c)&&n.call(o,t[c],c);return t}function i(t){return"[object Array]"===Object.prototype.toString.call(t)}function n(t){return"object"==typeof t&&null!==t}function r(t){return"function"==typeof t}function o(t){if(Object.create)return Object.create(t);var e=function(){};return e.prototype=t,new e}var c,a={},s=1;return t.isCommandEl=function(t){return t.nodeType===s&&"U"===t.nodeName},t.prototype={constructor:t,isRoot:!1,refreshAttrs:function(){return this.attrs={},e(this.el.attributes,function(t){if(t.specified){var e=t.name,i=this.el.getAttribute(e,3);this.attrs[c.normalizeAttr(e)]=i}},this),this},updateChildren:function(){return this.children=[],this._loopThroughEl(this.el.childNodes),this},_loopThroughEl:function(i){return e(i,function(e){if(t.isCommandEl(e)){var i=new t(e,this);this.children.push(i),i.updateChildren()}else e.nodeType===s&&this._loopThroughEl(e.childNodes)},this),this},execute:function(){return e(this._sortedDirectives(),function(t){a[t].execute(this.el,this.attrs[t],this)},this),this.executeChildren(),this},executeChildren:function(){return e(this.children,function(t){t.execute()}),this},_sortedDirectives:function(){var t=[];return e(this.attrs,function(e,i){a[i]&&t.push(i)},this),t.sort(function(t,e){return a[t].priority-a[e].priority})},getElContent:function(){return this.el.innerHTML}},c={Command:t,compile:function(e){var i;i=document.createElement("u"),i.innerHTML=e;var n=new t(i);return n.isRoot=!0,n},priorityAlias:{high:10,medium:20,low:30,"default":30},regDirectives:a,addDirective:function(t,e){if("function"==typeof e&&(e={execute:e}),e.priority?"string"==typeof e.priority&&(e.priority=this.priorityAlias[e.priority]):e.priority=this.priorityAlias["default"],isNaN(e.priority))throw"Unknown priority given for directive `"+t+"` : "+e.priority;if(!r(e.execute))throw"No execute function was given for directive : "+t;a[t]=e},normalizeAttr:function(){function t(t){return t.replace(i,function(t,e,i,n){return n?i.toUpperCase():i}).replace(n,"Moz$1")}var e=/^(x[\:\-_]|data[\:\-_])/i,i=/([\:\-\_]+(.))/g,n=/^moz([A-Z])/;return function(i){return t(i.replace(e,""))}}(),forEach:e,isArray:i,isObject:n,isFn:r,makeInherit:o}}();mentDoc.addDirective("inEl",function(t,e,i){i.data.inEl=e}),mentDoc.addDirective("appendTo",function(t,e,i){$(e,i.data.inEl).append(i.getElContent())}),mentDoc.addDirective("empty",{priority:"medium",execute:function(t,e,i){$(e,i.data.inEl).empty()}}),mentDoc.addDirective("remove",function(t,e,i){$(e,i.data.inEl).remove()}),mentDoc.markdown={convertHtml:function(t){var e=Markdown.getSanitizingConverter();Markdown.Extra.init(e,{extensions:"all",highlighter:"prettify"});var i=t.match(/(\t| )+\^\^\^/g);if(i){var n=i[0].length-3;lines=t.split(/\n/g);for(var r=0;lines.length>r;r++)lines[r]=lines[r].substring(n),"^^^"===lines[r]&&(lines[r]="");t=lines.join("\n")}return e.makeHtml(t)}},mentDoc.addDirective("markdown",{priority:"high",execute:function(t,e,i){i.data.compiledMarkdown=mentDoc.markdown.convertHtml(i.getElContent()),i.getElContent=function(){return i.data.compiledMarkdown}}}),"undefined"!=typeof module&&module.exports&&(module.exports.mentDoc=mentDoc);